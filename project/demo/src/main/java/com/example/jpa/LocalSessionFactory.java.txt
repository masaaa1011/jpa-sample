package com.example.jpa;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.orm.jpa.JpaVendorAdapter;
import org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
import org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;

@Configuration
public class LocalSessionFactory{
    private static String PROP_DB_DRIVER_CLASS = "org.postgresql.Driver";
    private static String PROP_DB_URL = "jdbc:postgresql://postgresdb:5432/postgres";
    private static String PROP_DB_USER = "postgres";
    private static String PROP_DB_PASS = "postgres";
    
    @Autowired
    private Environment env;
    
    @Bean
    public DataSource dataSource(){
          DriverManagerDataSource dataSource = new DriverManagerDataSource();
          dataSource.setDriverClassName(PROP_DB_DRIVER_CLASS);
          dataSource.setUrl(PROP_DB_URL);
          dataSource.setUsername(PROP_DB_USER);
          dataSource.setPassword(PROP_DB_PASS);
          return dataSource;
    }
    
    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
          LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();
          em.setDataSource(dataSource());
          em.setPackagesToScan("com.example");
    
          JpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();
          em.setJpaVendorAdapter(vendorAdapter);
    
          return em;
    }
}
    